pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- vars
function _init()
	p = {
		x=0,
		y=0,
		dx=0,
		dy=0,
		acc=0.3,
		dx_max=2,
		dy_max=4,
		v_boost=6,
		sprite=1,
		w=16,
		h=16,
		flp=false,
		anim=0,
		landed=true,
		jumping=false,
		falling=false,
		sliding=false,
		running=false
		}
	
	world={
		gravity=0.5,
		friction=0.85,
		start=0,
		ending=256
	}
	
	cam={
	x=0
	}
	
end
-->8
-- update

function _update60()
	player_update()
	player_animate()
	camera_scrolling()
	
	
end

function _draw()
	cls()
	map(0,0)
	spr(p.sprite,p.x,p.y,p.w/8,p.h/8,p.flp)
end
-->8
-- physics
function collide_map(obj,aim,flag)
	local x=obj.x local y=obj.y
	local w=obj.w local h=obj.h
	
	local x1=0 local y1=0
	local x2=0 local y2=0
	
	if aim=="left" then
		x1=x	y1=y
		x2=x y2=y+h-1
	elseif aim=="right" then
		x1=x+w-2 y1=y
		x2=x+w-2 y2=y+h-1
	elseif aim=="up" then
		x1=x+1 y1=y-1
		x2=x+w-1 y2=y
	elseif aim=="down" then
		x1=x y1=y+h
		x2=x+w y2=y+h
	end
	
	x1/=8 y1/=8
	x2/=8 y2/=8
	
	if fget(mget(x1,y1),flag)
	or fget(mget(x1,y2),flag)
	or fget(mget(x2,y1),flag)
	or fget(mget(x2,y2),flag) then
		printh("collision with world: "..aim)
		return true
	else 
		printh("no collision: "..aim)
		return false
	end
end
-->8
-- player
function player_update()
	p.dy+=world.gravity
	p.dx*=world.friction
	
	if btn(0) then
		if p.dx>-p.dx_max then
			p.dx-=p.acc
		else
			p.dx=-p.dx_max
		end
		p.running=true
		p.flp=true
	else
		p.running=false
	end

	if btn(1) then
		if p.dx<p.dx_max then
			p.dx+=p.acc
		else
			p.dx=p.dx_max
		end
		p.running=true
		p.flp=false
	else
		p.running=false
	end

	if (btn(❎) or btn(2)) and p.landed then
		p.dy-=p.v_boost
		p.jumping=true
		p.landed=false
	end
	
	if p.dy>0 then
		p.falling=true
		p.landed=false
		p.jumping=false
		p.dy=mid(-p.dy_max,p.dy,p.dy_max)
		if collide_map(p,"down",0) then
			p.landed=true
			p.falling=false
			p.dy=0
			p.y-=(p.y+p.h)%8
		end
	elseif p.dy<0 then
		p.jumping=true
		if collide_map(p,"up",1) then
			p.dy=0
		end
	end
	
	if p.dx<0 then
		if collide_map(p,"left",1) then
			p.dx=0
		end
	elseif p.dx>0 then
		if collide_map(p,"right",1) then
			p.dx=0
		end
	end
	
	p.x+=p.dx
	
	p.y+=p.dy
	
	if p.x<world.start then
		p.x=world.start
	elseif p.x>world.ending-p.w then
		p.x=world.ending-p.w
	end
end

function player_animate()
	if p.jumping then
		p.sprite=7
	elseif p.falling then
		p.sprite=9
	elseif p.sliding then
		p.sprite=11
	elseif p.running then
		if time()-p.anim>.2 then
			p.anim=time()
			p.sprite+=2
			if p.sprite>5 then
				p.sprite=3
			end
		end
	else
		p.sprite=1
	end
end
-->8
-- camera

function camera_scrolling()
	cam.x=p.x-45
	
	if (cam.x<world.start) then
	 cam.x=world.start
	elseif (cam.x+128>world.ending) then
	cam.x=world.ending-128
	end
	camera(cam.x,0)
end
-->8
--debug

function draw_hitbox()
end

__gfx__
00000000000055555500000000000005555550000000000555555000000000055555500000555555000000000000000000000000000000000000000000000000
0000000000005ffff550000000000005ffff550000000005ffff550000000005ffff5500005ffff5500000000000000000000000000000000000000000000000
00700700000055ffff550000000000055ffff550000000055ffff550000000055ffff5500055ffff550000000000555555000000000000000000000000000000
000770000000555fff5000000000000555fff5000000000555fff5000000000555fff50000555fff5000000000005ffff5500000000000000000000000000000
0007700000000ffff000000000000000ffff000000000000ffff000000000000ffff0000000ffff000000000000055ffff550000000000000000000000000000
007007000000dddddd00000000000000dddd000000000000dddd000000000001dddd0000001dddd0000000000000555fff500000000000000000000000000000
00000000000d0dddd0d000000000000ddddd100000000001ddddd00000000010dddd0000010dddd00000000000000ffff0000000000000000000000000000000
000000000000dddddd000000000000d0dddd010000000010dddd0d000000070ddddd000070ddddd00000000000001dddd0000000000000000000000000000000
00000000000007dd7000000000000700dddd007000000700dddd007000000070dddd0000070dddd00000000000010dddd0000000000000000000000000000000
00000000000011111100000000000001111110000000000111111000000000011111100000011111100000000070ddddd0000000000000000000000000000000
0000000000011dddd110000000000011dddd100000000011dddd100000000011dddd10000001dddd1100000000070dddd0000000000000000000000000000000
000000000001dddddd100000000001dddddd1000000001dddddd1000000001dddddd10000001dddddd1000000000011111100000000000000000000000000000
000000000011dddddd110000000001dddddd1000000001dddddd1000000001dddddd10000001dddddd10000000001ddddd110000000000000000000000000000
00000000001dddddddd1000000001ddddddd100000001ddddddd100000001dddddd1100000011dddddd100000001ddddddd10000000000000000000000000000
00000000001dddddddd100000001dddddddd10000001dddddddd10000001dddddd100000000001dddddd1000001ddddddddd1000000000000000000000000000
00000000001dddddddd100000001dddddddd10000001dddddddd10000001ddddd10000000000001ddddd100001dddddddddd1000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb00bbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb3bbbbbbbbbbbbbbbbbbbbbbbbbbbb0bbbbbbbb33bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bb3bbb33bbbbbb333b33bb333b3bbb3bbb33b3333433bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000
43b43b3443bbbb344433433443b3bb34b33433444444433b00000000000000000000000000000000000000000000000000000000000000000000000000000000
44344344443bbb34444444444433bb34b34444444544443b00000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444443bbb34444d44444443b344b3446444444443bb00000000000000000000000000000000000000000000000000000000000000000000000000000000
4d4444444d43334444444444444434d433444444444943bb00000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444444444444444443300000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444d44444444444444474444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444844444744477444446444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44555444448284444444764444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
45666544444844444477644444444544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
45666544444446444447444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44555444444444444444445444644444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030303030300000000000000000000030303030000000000000000000000000100000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000444500000000000000006060606000004443424500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000444041535045000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000044535053525353424345000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4340414053535353535353535353404243404041404042424040434240404342000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5351535053535350505353525350535353535353535353535353535353535353530000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5053535350535253535153535053525353535353535353535353535353535353530000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
